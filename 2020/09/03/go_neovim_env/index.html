<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"amikai.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!0,lazyload:!0,pangu:!0,comments:{style:"tabs",active:"gitalk",storage:!0,lazyload:!1,nav:null,activeClass:"gitalk"},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="你確定要用 neovim 開發 golang?現在是 vscode 稱霸天下的時代，理所當然的 (neo)vim 也常常被拿來 vscode 比較，vscode 內建整合了 git、debugger、自動補全引擎、terminal、extension manager，另外 Golang 在 vscode 上的 extension 支援相當良好: 包括跳轉到定義 (go to definitio"><meta property="og:type" content="article"><meta property="og:title" content="Golang 開發環境 - 使用 neovim"><meta property="og:url" content="https://amikai.github.io/2020/09/03/go_neovim_env/index.html"><meta property="og:site_name" content="no code no pain"><meta property="og:description" content="你確定要用 neovim 開發 golang?現在是 vscode 稱霸天下的時代，理所當然的 (neo)vim 也常常被拿來 vscode 比較，vscode 內建整合了 git、debugger、自動補全引擎、terminal、extension manager，另外 Golang 在 vscode 上的 extension 支援相當良好: 包括跳轉到定義 (go to definitio"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://amikai.github.io/2020/09/03/go_neovim_env/cover.png"><meta property="og:image" content="https://amikai.github.io/2020/09/03/go_neovim_env/defx.png"><meta property="og:image" content="https://amikai.github.io/2020/09/03/go_neovim_env/diagnostic_demo.gif"><meta property="og:image" content="https://amikai.github.io/2020/09/03/go_neovim_env/completion_demo.gif"><meta property="og:image" content="https://amikai.github.io/2020/09/03/go_neovim_env/tagbar_demo.png"><meta property="og:image" content="https://amikai.github.io/2020/09/03/go_neovim_env/golangci_lint_demo.gif"><meta property="og:image" content="https://amikai.github.io/2020/09/03/go_neovim_env/go_test_demo.gif"><meta property="article:published_time" content="2020-09-03T02:48:54.000Z"><meta property="article:modified_time" content="2020-09-08T10:58:08.758Z"><meta property="article:author" content="amikai"><meta property="article:tag" content="vim"><meta property="article:tag" content="neovim"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://amikai.github.io/2020/09/03/go_neovim_env/cover.png"><link rel="canonical" href="https://amikai.github.io/2020/09/03/go_neovim_env/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>Golang 開發環境 - 使用 neovim | no code no pain</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-172478407-1"></script><script>if(CONFIG.hostname===location.hostname){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-172478407-1")}</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="no code no pain" type="application/atom+xml"></head><body itemscope="" itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">no code no pain</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">amikai notes</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> Archives</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/amikai" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener noreferrer" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://amikai.github.io/2020/09/03/go_neovim_env/"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.JPEG"><meta itemprop="name" content="amikai"><meta itemprop="description" content=""></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="no code no pain"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Golang 開發環境 - 使用 neovim</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-09-03 10:48:54" itemprop="dateCreated datePublished" datetime="2020-09-03T10:48:54+08:00">2020-09-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2020-09-08 18:58:08" itemprop="dateModified" datetime="2020-09-08T18:58:08+08:00">2020-09-08</time></span><span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">Views:</span><span id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"> <img data-src="/2020/09/03/go_neovim_env/cover.png" class=""><h1 id="你確定要用-neovim-開發-golang"><a href="#你確定要用-neovim-開發-golang" class="headerlink" title="你確定要用 neovim 開發 golang?"></a>你確定要用 neovim 開發 golang?</h1><p>現在是 vscode 稱霸天下的時代，理所當然的 (neo)vim 也常常被拿來 vscode 比較，vscode 內建整合了 git、debugger、自動補全引擎、terminal、extension manager，另外 Golang 在 vscode 上的 extension 支援相當良好: 包括跳轉到定義 (go to definition)、重新命名 (rename)、跳轉到型態定義 (go to type definition)⋯⋯ 一堆細節功能，近期由於 google golang team 接手 go 語言的 vscode extension，相信使用 vscode 開發是不錯的選擇。</p><p> (neo)vim 當然也能達到 vscode 的類似功能，但是必須花時間設定調教，在 vscode 問世之前我會推薦 (Neo)vim 給我的朋友，vscode 問世之後我就開始推薦 vscode。</p><blockquote><p>本文給那些本來就在 (neo)vim 裡打滾的人，但對 go 語言設定不熟的人，<br>如果你是一張白紙，而且沒有被虐的癖好，我建議選擇 vscode，可以用較少的時間進入到寫程式的環節，而不是一直在花時間在設定，這篇文你也沒必要看下去。</p></blockquote><h1 id="預備動作"><a href="#預備動作" class="headerlink" title="預備動作"></a>預備動作</h1><p>Must have</p><ul><li>你應該先安裝好 neovim nightly 版本，<code>brew install neovim --HEAD</code></li><li>你應該要知道怎麼使用 vim-plug，至少要知道 <code>:PlugInstall</code></li><li>你應該先把 go 語言環境安裝好</li></ul><p>Nice to have</p><ul><li>你知道 <code>:checkhealth</code> 和 <code>:UpdateRemotePlugin</code></li><li>你熟悉 <code>:help</code> 的使用方式，這裡有一篇好文：<a href="https://vim.fandom.com/wiki/Learn_to_use_help" target="_blank" rel="noopener noreferrer">Learn to use help</a></li></ul><h1 id="開發環境基本功能"><a href="#開發環境基本功能" class="headerlink" title="開發環境基本功能"></a>開發環境基本功能</h1><p>一個好用的 Editor 我認為應該包含以下幾點基本功能:</p><ul><li>Auto completion - 好的自動補全引擎</li><li>File manager - 可以在側邊欄看到專案的結構</li><li>Real time linter - 在寫 code 犯錯的同時，有一些提示 (也就是 diagnostic 功能)</li><li>Background compile - 編譯的同時不應該卡住整個 Editor，要讓使用者能做其他事情</li><li>Code navigation: 包含跳轉到定義，跳轉到型態定義，或是當一個檔案寫得很長的時候，怎麼綜觀全局</li></ul><p>以下我將會介紹我使用的 Plugin，達到我上述所提到的功能。<br>以下使用的皆是 Neovim nightly 版本，使用 stable 是沒有官方 LSP 支援的。</p><p>Note：neovim 是由 vim 所 fork 出來的，差異介紹請看<a href="https://kerol2r20.github.io/post/2017-10-29-neovim-introdunction/" target="_blank" rel="noopener noreferrer">這篇</a>，某些 Plugin 不會同時相容於兩者，我接會標明。</p><a id="more"></a><h1 id="File-explorer-defx-nvim"><a href="#File-explorer-defx-nvim" class="headerlink" title="File explorer (defx.nvim)"></a>File explorer (defx.nvim)</h1><img data-src="/2020/09/03/go_neovim_env/defx.png" class=""><p>為什麼不用老牌的 nerdtree 就好，要使用別的 file explorer，<br>沒辦法 nerdtree 就是慢，只要專案稍微有一點規模，就會有明顯的卡頓。</p><p>defx 由 python3 寫成，是一個需要高度手動設定的 file explorer，不像 nerdtree 幾乎可以開箱及用，在設定時一定得查看 defx 的 help 文件，裡頭有相當多設定範例。</p><p>為了讓 neovim 知道 python3 在哪，將此行寫入 vimrc：</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:python3_host_prog</span> = <span class="string">'/path/to/python3'</span></span><br></pre></td></tr></tbody></table></figure><p>設定完此行之行 執行 <code>:checkhealth</code>，neovim 就會開始查看有沒有抓到 python3</p><p>安裝</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plug <span class="string">'Shougo/defx.nvim'</span></span><br></pre></td></tr></tbody></table></figure><p>安裝完後執行 <code>:UpdateRemotePlugins</code></p><p>使用 F4 映射到 defx</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">noremap</span> <span class="symbol">&lt;silent&gt;</span><span class="symbol">&lt;F4&gt;</span> <span class="symbol">&lt;cmd&gt;</span>Defx -<span class="keyword">buffer</span>-name=<span class="string">"defx"</span><span class="symbol">&lt;cr&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>外觀設定</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> defx#custom#column(<span class="string">'icon'</span>, {</span><br><span class="line">            \ <span class="string">'directory_icon'</span>: <span class="string">'▸'</span>,</span><br><span class="line">            \ <span class="string">'opened_icon'</span>: <span class="string">'▾'</span>,</span><br><span class="line">            \ <span class="string">'root_icon'</span>: <span class="string">'📁 '</span>,</span><br><span class="line">            \ })</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> defx#custom#column(<span class="string">'filename'</span>, {</span><br><span class="line">            \ <span class="string">'min_width'</span>: <span class="number">128</span>,</span><br><span class="line">            \ <span class="string">'max_width'</span>: <span class="number">128</span>,</span><br><span class="line">            \ })</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> defx#custom#option(<span class="string">'_'</span>, {</span><br><span class="line">            \ <span class="string">'columns'</span>: <span class="string">'mark:indent:icon:filename:type'</span>,</span><br><span class="line">            \ <span class="string">'split'</span>: <span class="string">'vertical'</span>,</span><br><span class="line">            \ <span class="string">'winwidth'</span>: <span class="number">35</span>,</span><br><span class="line">            \ <span class="string">'direction'</span>: <span class="string">'topleft'</span>,</span><br><span class="line">            \ <span class="string">'resume'</span>: <span class="variable">v:false</span>,</span><br><span class="line">            \ <span class="string">'toggle'</span>: <span class="variable">v:true</span></span><br><span class="line">            \ })</span><br></pre></td></tr></tbody></table></figure><p>使用 enter 打開或關閉資料夾：</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;silent&gt;</span><span class="symbol">&lt;buffer&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;CR&gt;</span></span><br><span class="line">            \ defx#is_directory() ?</span><br><span class="line">            \ defx#do_action(<span class="string">'open_or_close_tree'</span>) :</span><br><span class="line">            \ defx#do_action(<span class="string">'drop'</span>)</span><br></pre></td></tr></tbody></table></figure><p>因為 defx 的高度彈性，以及舊有的 nerdtree使用習慣，所以我就把 defx 的 key mapping 設定成類似 nerdtree，這裡就只做基本設定，以後有空會多開一篇詳細講 defx 設定，如果有興趣請參考<a href="https://github.com/amikai/nvimrc/blob/46d4c73f9e/config/defx.vim" target="_blank" rel="noopener noreferrer">我的設定</a></p><p>Note: defx (neovim only)</p><p>類似 Plugin: <a href="https://github.com/preservim/nerdtree" target="_blank" rel="noopener noreferrer">nerdtree</a> (vim and neovim), <a href="https://github.com/justinmk/vim-dirvish" target="_blank" rel="noopener noreferrer">vim-dirvish</a> (vim and neovim)</p><h1 id="Auto-completion-completion-nvim-amp-diagnostic-diagnostic-nvim"><a href="#Auto-completion-completion-nvim-amp-diagnostic-diagnostic-nvim" class="headerlink" title="Auto completion (completion-nvim) &amp; diagnostic (diagnostic-nvim)"></a>Auto completion (completion-nvim) &amp; diagnostic (diagnostic-nvim)</h1><p>completion-nvim 和 diagnostic-nvim 都是基於 nvim-lspconfig 的 Plugin，<br>可以把 nvim-lspconfig 當成和 language server 溝通的基礎設施，Golang 預設的 language server 當然就是 gopls 啦</p><p>安裝</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Plug <span class="string">'neovim/nvim-lspconfig'</span></span><br><span class="line">Plug <span class="string">'nvim-lua/diagnostic-nvim'</span></span><br><span class="line">Plug <span class="string">'nvim-lua/completion-nvim'</span></span><br></pre></td></tr></tbody></table></figure><p>在 lsp client 時，啟動 <code>completion-nvim</code> 和 <code>diagnostic-nvim</code>：</p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lua &lt;&lt; EOF</span><br><span class="line">    <span class="keyword">local</span> nvim_lsp = <span class="built_in">require</span><span class="string">'nvim_lsp'</span></span><br><span class="line">    <span class="keyword">local</span> on_attach_vim = <span class="function"><span class="keyword">function</span><span class="params">(client, bufnr)</span></span></span><br><span class="line">        <span class="built_in">require</span><span class="string">'completion'</span>.on_attach(client, bufnr)</span><br><span class="line">        <span class="built_in">require</span><span class="string">'diagnostic'</span>.on_attach(client, bufnr)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    nvim_lsp.gopls.setup{</span><br><span class="line">        on_attach=on_attach_vim</span><br><span class="line">    }</span><br><span class="line">EOF</span><br></pre></td></tr></tbody></table></figure><p><code>diagnostic-nvim</code> 範例設定：</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> sign_define(<span class="string">"LspDiagnosticsErrorSign"</span>, {<span class="string">"text"</span> : <span class="string">"E"</span>, <span class="string">"texthl"</span> : <span class="string">"LspDiagnosticsError"</span>})</span><br><span class="line"><span class="keyword">call</span> sign_define(<span class="string">"LspDiagnosticsWarningSign"</span>, {<span class="string">"text"</span> : <span class="string">"W"</span>, <span class="string">"texthl"</span> : <span class="string">"LspDiagnosticsWarning"</span>})</span><br><span class="line"><span class="keyword">call</span> sign_define(<span class="string">"LspDiagnosticsInformationSign"</span>, {<span class="string">"text"</span> : <span class="string">"I"</span>, <span class="string">"texthl"</span> : <span class="string">"LspDiagnosticsInformation"</span>})</span><br><span class="line"><span class="keyword">call</span> sign_define(<span class="string">"LspDiagnosticsHintSign"</span>, {<span class="string">"text"</span> : <span class="string">"H"</span>, <span class="string">"texthl"</span> : <span class="string">"LspDiagnosticsHint"</span>})</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:diagnostic_show_sign</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:diagnostic_enable_virtual_text</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:diagnostic_insert_delay</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:diagnostic_virtual_text_prefix</span> = <span class="string">'&lt;'</span></span><br></pre></td></tr></tbody></table></figure><p>效果：</p> <img data-src="/2020/09/03/go_neovim_env/diagnostic_demo.gif" class=""><p>如果覺得字還沒打完就有警告很煩，可以改變此選項 <code>let g:diagnostic_insert_delay = 1</code>，則會在進入 normal mode 時進行警告。</p><p><code>completion-nvim</code> 範例設定：</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:completion_chain_complete_list</span> = [</span><br><span class="line">            \{<span class="string">'complete_items'</span>: [<span class="string">'lsp'</span>]},</span><br><span class="line">            \]</span><br></pre></td></tr></tbody></table></figure><p>效果</p> <img data-src="/2020/09/03/go_neovim_env/completion_demo.gif" class=""><p>Note: <code>nvim-lspconfig</code>, <code>completion-nvim</code>, <code>diagnostic-nvim</code> 皆不相容 vim</p><p>LSP 相關 Plugin： <a href="https://github.com/prabirshrestha/vim-lsp" target="_blank" rel="noopener noreferrer">vim-lsp</a> (vim only), <a href="https://github.com/autozimu/LanguageClient-neovim" target="_blank" rel="noopener noreferrer">LanguageClient-neovim</a> (neovim only)</p><p>Completion 相關 Plugin： <a href="https://github.com/ncm2/ncm2" target="_blank" rel="noopener noreferrer">ncm2</a> (vim8 and neovim), <a href="https://github.com/Shougo/deoplete.nvim" target="_blank" rel="noopener noreferrer">deoplete.nvim</a> (vim8 and neovim)</p><p>Diagnostic 相關 Plugin: <a href="https://github.com/neomake/neomake" target="_blank" rel="noopener noreferrer">neomake</a> (neovim and vim8), <a href="https://github.com/dense-analysis/ale" target="_blank" rel="noopener noreferrer">ale</a> (neovim and vim8)</p><blockquote><p>看了 completion-nvim 的 contribution 大部分是由 haorenW1025 大大所寫，帳號掛 NTU，台灣人寫的套件還不支持一波</p></blockquote><h1 id="Code-Outline-tagbar"><a href="#Code-Outline-tagbar" class="headerlink" title="Code Outline (tagbar)"></a>Code Outline (tagbar)</h1><img data-src="/2020/09/03/go_neovim_env/tagbar_demo.png" class=""><p>當 code 越寫越多，一個 file 越長越大，一個 file 超過 1000 行，或超過 15 個 function，就需要一個綜觀全局的 Plugin，這當然就需要交給 <code>tagbar</code> 了。</p><p>另外一種情境，當你不熟你手上的這份專案時，用 <code>tagbar</code> 先進行大綱式的觀察，是再好不過的方式了</p><p>首先先安裝 <a href="https://github.com/jstemmer/gotags" target="_blank" rel="noopener noreferrer">gotags</a>, gotags 在 Readme 上都寫好怎麼設定了。</p><p>安裝 Tagbar:</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plug <span class="string">'majutsushi/tagbar'</span></span><br></pre></td></tr></tbody></table></figure><p>gotags 及 tagbar 設定：</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:tagbar_type_go</span> = {</span><br><span class="line">            \ <span class="string">'ctagstype'</span> : <span class="string">'go'</span>,</span><br><span class="line">            \ <span class="string">'kinds'</span>     : [</span><br><span class="line">            \ <span class="string">'p:package'</span>,</span><br><span class="line">            \ <span class="string">'i:imports:1'</span>,</span><br><span class="line">            \ <span class="string">'c:constants'</span>,</span><br><span class="line">            \ <span class="string">'v:variables'</span>,</span><br><span class="line">            \ <span class="string">'t:types'</span>,</span><br><span class="line">            \ <span class="string">'n:interfaces'</span>,</span><br><span class="line">            \ <span class="string">'w:fields'</span>,</span><br><span class="line">            \ <span class="string">'e:embedded'</span>,</span><br><span class="line">            \ <span class="string">'m:methods'</span>,</span><br><span class="line">            \ <span class="string">'r:constructor'</span>,</span><br><span class="line">            \ <span class="string">'f:functions'</span></span><br><span class="line">            \ ],</span><br><span class="line">            \ <span class="string">'sro'</span> : <span class="string">'.'</span>,</span><br><span class="line">            \ <span class="string">'kind2scope'</span> : {</span><br><span class="line">            \ <span class="string">'t'</span> : <span class="string">'ctype'</span>,</span><br><span class="line">            \ <span class="string">'n'</span> : <span class="string">'ntype'</span></span><br><span class="line">            \ },</span><br><span class="line">            \ <span class="string">'scope2kind'</span> : {</span><br><span class="line">            \ <span class="string">'ctype'</span> : <span class="string">'t'</span>,</span><br><span class="line">            \ <span class="string">'ntype'</span> : <span class="string">'n'</span></span><br><span class="line">            \ },</span><br><span class="line">            \ <span class="string">'ctagsbin'</span>  : <span class="string">'gotags'</span>,</span><br><span class="line">            \ <span class="string">'ctagsargs'</span> : <span class="string">'-sort -silent'</span></span><br><span class="line">            \ }</span><br></pre></td></tr></tbody></table></figure><h1 id="Go-development-plugin-vim-go"><a href="#Go-development-plugin-vim-go" class="headerlink" title="Go development plugin (vim-go)"></a>Go development plugin (vim-go)</h1><p>Golang 在 vim 的開發中，不可能不提 <code>vim-go</code> 了，應該也是我在 vim plugin 看過支援完整的開發工具之一了，vim-go 設定眾多，我只挑出了我覺得最有用的幾個出來談。</p><p>安裝</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plug <span class="string">'fatih/vim-go'</span>,{<span class="string">'for'</span>:<span class="string">'go'</span>, <span class="string">'do'</span>: <span class="string">':GoUpdateBinaries'</span>}</span><br></pre></td></tr></tbody></table></figure><p><a href="https://github.com/golangci/golangci-lint" target="_blank" rel="noopener noreferrer">golangci-lint</a> 是把不一樣的 go 語言 linter 集合起來成一包，在 teminal 打 <code>golangci-lint linters</code> 就會列出一堆 linter，挑選自己想要的 linter 放入 <code>g:go_metalinter_enabled</code> 陣列裡。</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:go_metalinter_command</span> = <span class="string">"golangci-lint"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:go_metalinter_enabled</span> = [<span class="string">'vet'</span>, <span class="string">'errcheck'</span>, <span class="string">'staticcheck'</span>, <span class="string">'gosimple'</span>]</span><br></pre></td></tr></tbody></table></figure><p>使用 <code>:GoMetaLinter</code> 開始對專案進行檢查。</p><p>當然 code 越大或是 linter 放得越多檢查越慢，所以我通常寫到一個段落才下此命令，linter 檢查完後 quickfix list 則會跳出，請看demo：</p> <img data-src="/2020/09/03/go_neovim_env/golangci_lint_demo.gif" class=""><p>code navigation 設定，不使用 <code>vim-go</code> 預設的 key mapping，使用自己習慣的方式：</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:go_def_mapping_enabled</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> gd <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-def)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> gD <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-describe)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> gR <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-<span class="built_in">rename</span>)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> <span class="keyword">gr</span> <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-referrers)</span><br></pre></td></tr></tbody></table></figure><p>最屌的是 vim-go 能直接跑 Testing (<code>:GoTest</code>), Debugger (<code>:GoDebugStart</code>), Run (<code>:GoRun</code>), Build (<code>:GoBuild</code>)</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> <span class="symbol">&lt;f4&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-test)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> <span class="symbol">&lt;f5&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-build)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> <span class="symbol">&lt;f6&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-run)</span><br></pre></td></tr></tbody></table></figure><p><code>:GoTest</code> demo：</p> <img data-src="/2020/09/03/go_neovim_env/go_test_demo.gif" class=""><p>vim-go 設定一定要看過 <a href="https://github.com/fatih/vim-go-tutorial" target="_blank" rel="noopener noreferrer">vim-go-tutorial</a>，由 vim-go 作者提供的設定教學。</p><h1 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h1><p>如果要一個適合自己的 (neo)vim 環境，當然這篇文章只是冰山一角而已。這裡提到的 Plugin，每一個都可以開一篇文章來介紹，所以每一個 Plugin 我盡量用最簡單的範例設定，展現它的功能和精髓。另外還有 fuzzy finder, auto pair, indent line guide, snippet ..等 Plugin, 還沒提到，之後會分好幾篇文章來寫。</p><p>在配置設定的一開始，盡量先去抄別人的，直接看看抄了設定會發生什麼效果， 或是使用 <code>:help</code> 查詢看看。</p><h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h1><p>要去哪裡查到別人的 vim 設定？<br>在 github 上查詢關鍵字：dotfile, dotfiles, vimrc, vim-config, nvimrc 等等的字。<br>這裡我就提供兩個大神的 vim 設定：</p><ul><li><a href="https://github.com/Shougo/shougo-s-github" target="_blank" rel="noopener noreferrer">https://github.com/Shougo/shougo-s-github</a></li><li><a href="https://github.com/rafi/vim-config" target="_blank" rel="noopener noreferrer">https://github.com/rafi/vim-config</a></li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li><a href="https://github.com/neovim/nvim-lspconfig" target="_blank" rel="noopener noreferrer">https://github.com/neovim/nvim-lspconfig</a></li><li><a href="https://github.com/fatih/vim-go-tutorial" target="_blank" rel="noopener noreferrer">https://github.com/fatih/vim-go-tutorial</a></li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/vim/" rel="tag"># vim</a> <a href="/tags/neovim/" rel="tag"># neovim</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/07/07/golang78syntax2/" rel="prev" title="Golang 78 語法篇 - method set"><i class="fa fa-chevron-left"></i> Golang 78 語法篇 - method set</a></div><div class="post-nav-item"> <a href="/2020/09/07/vim-mark-tips/" rel="next" title="聊聊 vim mark 使用情境 - code 參照">聊聊 vim mark 使用情境 - code 參照<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="gitalk-container"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#你確定要用-neovim-開發-golang"><span class="nav-number">1.</span> <span class="nav-text">你確定要用 neovim 開發 golang?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#預備動作"><span class="nav-number">2.</span> <span class="nav-text">預備動作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#開發環境基本功能"><span class="nav-number">3.</span> <span class="nav-text">開發環境基本功能</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#File-explorer-defx-nvim"><span class="nav-number">4.</span> <span class="nav-text">File explorer (defx.nvim)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Auto-completion-completion-nvim-amp-diagnostic-diagnostic-nvim"><span class="nav-number">5.</span> <span class="nav-text">Auto completion (completion-nvim) &amp; diagnostic (diagnostic-nvim)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Code-Outline-tagbar"><span class="nav-number">6.</span> <span class="nav-text">Code Outline (tagbar)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Go-development-plugin-vim-go"><span class="nav-number">7.</span> <span class="nav-text">Go development plugin (vim-go)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#結語"><span class="nav-number">8.</span> <span class="nav-text">結語</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Q-amp-A"><span class="nav-number">9.</span> <span class="nav-text">Q &amp; A</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">10.</span> <span class="nav-text">Reference</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="amikai" src="/images/avatar.JPEG"><p class="site-author-name" itemprop="name">amikai</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">9</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">1</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">4</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/amikai" title="GitHub → https://github.com/amikai" rel="noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:as23041248@gmail.com" title="E-Mail → mailto:as23041248@gmail.com" rel="noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> © <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">amikai</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener noreferrer" target="_blank">Hexo</a> &amp; <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener noreferrer" target="_blank">NexT.Pisces</a></div><div class="busuanzi-count"><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="Total Views"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'a7fb427a2efcda5f9e1e',
      clientSecret: '4553b6babb44ed8fbe989a20ea43655bdc344bbf',
      repo        : 'amikai.github.io',
      owner       : 'amikai',
      admin       : ['amikai'],
      id          : '99ce5f546f0937ef4f71f75b4c67e1db',
        language: 'en',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script></body></html>
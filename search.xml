<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Golang é–‹ç™¼ç’°å¢ƒ - ä½¿ç”¨ neovim</title>
    <url>/2020/09/03/go_neovim_env/</url>
    <content><![CDATA[<img data-src="/2020/09/03/go_neovim_env/cover.png" class="">

<h1 id="ä½ ç¢ºå®šè¦ç”¨-neovim-é–‹ç™¼-golang"><a href="#ä½ ç¢ºå®šè¦ç”¨-neovim-é–‹ç™¼-golang" class="headerlink" title="ä½ ç¢ºå®šè¦ç”¨ neovim é–‹ç™¼ golang?"></a>ä½ ç¢ºå®šè¦ç”¨ neovim é–‹ç™¼ golang?</h1><p>ç¾åœ¨æ˜¯ vscode ç¨±éœ¸å¤©ä¸‹çš„æ™‚ä»£ï¼Œç†æ‰€ç•¶ç„¶çš„ (neo)vim ä¹Ÿå¸¸å¸¸è¢«æ‹¿ä¾† vscode æ¯”è¼ƒï¼Œvscode å…§å»ºæ•´åˆäº† gitã€debuggerã€è‡ªå‹•è£œå…¨å¼•æ“ã€terminalã€extension managerï¼Œå¦å¤– Golang åœ¨ vscode ä¸Šçš„ extension æ”¯æ´ç›¸ç•¶è‰¯å¥½: åŒ…æ‹¬è·³è½‰åˆ°å®šç¾© (go to definition)ã€é‡æ–°å‘½å (rename)ã€è·³è½‰åˆ°å‹æ…‹å®šç¾© (go to type definition)â‹¯â‹¯ ä¸€å †ç´°ç¯€åŠŸèƒ½ï¼Œè¿‘æœŸç”±æ–¼ google golang team æ¥æ‰‹ go èªè¨€çš„ vscode extensionï¼Œç›¸ä¿¡ä½¿ç”¨ vscode é–‹ç™¼æ˜¯ä¸éŒ¯çš„é¸æ“‡ã€‚</p>
<p> (neo)vim ç•¶ç„¶ä¹Ÿèƒ½é”åˆ° vscode çš„é¡ä¼¼åŠŸèƒ½ï¼Œä½†æ˜¯å¿…é ˆèŠ±æ™‚é–“è¨­å®šèª¿æ•™ï¼Œåœ¨ vscode å•ä¸–ä¹‹å‰æˆ‘æœƒæ¨è–¦ (Neo)vim çµ¦æˆ‘çš„æœ‹å‹ï¼Œvscode å•ä¸–ä¹‹å¾Œæˆ‘å°±é–‹å§‹æ¨è–¦ vscodeã€‚</p>
<blockquote>
<p>æœ¬æ–‡çµ¦é‚£äº›æœ¬ä¾†å°±åœ¨ (neo)vim è£¡æ‰“æ»¾çš„äººï¼Œä½†å° go èªè¨€è¨­å®šä¸ç†Ÿçš„äººï¼Œ<br>å¦‚æœä½ æ˜¯ä¸€å¼µç™½ç´™ï¼Œè€Œä¸”æ²’æœ‰è¢«è™çš„ç™–å¥½ï¼Œæˆ‘å»ºè­°é¸æ“‡ vscodeï¼Œå¯ä»¥ç”¨è¼ƒå°‘çš„æ™‚é–“é€²å…¥åˆ°å¯«ç¨‹å¼çš„ç’°ç¯€ï¼Œè€Œä¸æ˜¯ä¸€ç›´åœ¨èŠ±æ™‚é–“åœ¨è¨­å®šï¼Œé€™ç¯‡æ–‡ä½ ä¹Ÿæ²’å¿…è¦çœ‹ä¸‹å»ã€‚</p>
</blockquote>
<h1 id="é å‚™å‹•ä½œ"><a href="#é å‚™å‹•ä½œ" class="headerlink" title="é å‚™å‹•ä½œ"></a>é å‚™å‹•ä½œ</h1><p>Must have</p>
<ul>
<li>ä½ æ‡‰è©²å…ˆå®‰è£å¥½ neovim nightly ç‰ˆæœ¬ï¼Œ<code>brew install neovim --HEAD</code></li>
<li>ä½ æ‡‰è©²è¦çŸ¥é“æ€éº¼ä½¿ç”¨ vim-plugï¼Œè‡³å°‘è¦çŸ¥é“ <code>:PlugInstall</code></li>
<li>ä½ æ‡‰è©²å…ˆæŠŠ go èªè¨€ç’°å¢ƒå®‰è£å¥½</li>
</ul>
<p>Nice to have</p>
<ul>
<li>ä½ çŸ¥é“ <code>:checkhealth</code> å’Œ <code>:UpdateRemotePlugin</code></li>
<li>ä½ æ”¶æ‚‰ <code>:help</code> çš„ä½¿ç”¨æ–¹å¼ï¼Œé€™è£¡æœ‰ä¸€ç¯‡å¥½æ–‡ï¼š<a href="https://vim.fandom.com/wiki/Learn_to_use_help" target="_blank" rel="noopener">Learn to use help</a></li>
</ul>
<h1 id="é–‹ç™¼ç’°å¢ƒåŸºæœ¬åŠŸèƒ½"><a href="#é–‹ç™¼ç’°å¢ƒåŸºæœ¬åŠŸèƒ½" class="headerlink" title="é–‹ç™¼ç’°å¢ƒåŸºæœ¬åŠŸèƒ½"></a>é–‹ç™¼ç’°å¢ƒåŸºæœ¬åŠŸèƒ½</h1><p>ä¸€å€‹å¥½ç”¨çš„ Editor æˆ‘èªç‚ºæ‡‰è©²åŒ…å«ä»¥ä¸‹å¹¾é»åŸºæœ¬åŠŸèƒ½:</p>
<ul>
<li>Auto completion - å¥½çš„è‡ªå‹•è£œå…¨å¼•æ“</li>
<li>File manager - å¯ä»¥åœ¨å´é‚Šæ¬„çœ‹åˆ°å°ˆæ¡ˆçš„çµæ§‹</li>
<li>Real time linter - åœ¨å¯« code çŠ¯éŒ¯çš„åŒæ™‚ï¼Œæœ‰ä¸€äº›æç¤º (ä¹Ÿå°±æ˜¯ diagnostic åŠŸèƒ½)</li>
<li>Background compile - ç·¨è­¯çš„åŒæ™‚ä¸æ‡‰è©²å¡ä½æ•´å€‹ Editorï¼Œè¦è®“ä½¿ç”¨è€…èƒ½åšå…¶ä»–äº‹æƒ…</li>
<li>Code navigation: åŒ…å«è·³è½‰åˆ°å®šç¾©ï¼Œè·³è½‰åˆ°å‹æ…‹å®šç¾©ï¼Œæˆ–æ˜¯ç•¶ä¸€å€‹æª”æ¡ˆå¯«å¾—å¾ˆé•·çš„æ™‚å€™ï¼Œæ€éº¼ç¶œè§€å…¨å±€</li>
</ul>
<p>ä»¥ä¸‹æˆ‘å°‡æœƒä»‹ç´¹æˆ‘ä½¿ç”¨çš„ Pluginï¼Œé”åˆ°æˆ‘ä¸Šè¿°æ‰€æåˆ°çš„åŠŸèƒ½ã€‚<br>ä»¥ä¸‹ä½¿ç”¨çš„çš†æ˜¯ Neovim nightly ç‰ˆæœ¬ï¼Œä½¿ç”¨ stable æ˜¯æ²’æœ‰å®˜æ–¹ LSP æ”¯æ´çš„ã€‚</p>
<p>Noteï¼šneovim æ˜¯ç”± vim æ‰€ fork å‡ºä¾†çš„ï¼Œå·®ç•°ä»‹ç´¹è«‹çœ‹<a href="https://kerol2r20.github.io/post/2017-10-29-neovim-introdunction/" target="_blank" rel="noopener">é€™ç¯‡</a>ï¼ŒæŸäº› Plugin ä¸æœƒåŒæ™‚ç›¸å®¹æ–¼å…©è€…ï¼Œæˆ‘æ¥æœƒæ¨™æ˜ã€‚</p>
<h1 id="File-explorer-defx-nvim"><a href="#File-explorer-defx-nvim" class="headerlink" title="File explorer (defx.nvim)"></a>File explorer (defx.nvim)</h1><img data-src="/2020/09/03/go_neovim_env/defx.png" class="">

<p>ç‚ºä»€éº¼ä¸ç”¨è€ç‰Œçš„ nerdtree å°±å¥½ï¼Œè¦ä½¿ç”¨åˆ¥çš„ file explorerï¼Œ<br>æ²’è¾¦æ³• nerdtree å°±æ˜¯æ…¢ï¼Œåªè¦å°ˆæ¡ˆç¨å¾®æœ‰ä¸€é»è¦æ¨¡ï¼Œå°±æœƒæœ‰æ˜é¡¯çš„å¡é “ã€‚</p>
<p>defx ç”± python3 å¯«æˆï¼Œæ˜¯ä¸€å€‹éœ€è¦é«˜åº¦æ‰‹å‹•è¨­å®šçš„ file explorerï¼Œä¸åƒ nerdtree å¹¾ä¹å¯ä»¥é–‹ç®±åŠç”¨ï¼Œåœ¨è¨­å®šæ™‚ä¸€å®šå¾—æŸ¥çœ‹ defx çš„ help æ–‡ä»¶ï¼Œè£¡é ­æœ‰ç›¸ç•¶å¤šè¨­å®šç¯„ä¾‹ã€‚</p>
<p>ç‚ºäº†è®“ neovim çŸ¥é“ python3 åœ¨å“ªï¼Œå°‡æ­¤è¡Œå¯«å…¥ vimrcï¼š</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:python3_host_prog</span> = <span class="string">'/path/to/python3'</span></span><br></pre></td></tr></table></figure>
<p>è¨­å®šå®Œæ­¤è¡Œä¹‹è¡Œ åŸ·è¡Œ <code>:checkhealth</code>ï¼Œneovim å°±æœƒé–‹å§‹æŸ¥çœ‹æœ‰æ²’æœ‰æŠ“åˆ° python3</p>
<p>å®‰è£</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">Plug <span class="string">'Shougo/defx.nvim'</span></span><br></pre></td></tr></table></figure>
<p>å®‰è£å®Œå¾ŒåŸ·è¡Œ <code>:UpdateRemotePlugins</code></p>
<p>ä½¿ç”¨ F4 æ˜ å°„åˆ° defx</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">noremap</span> <span class="symbol">&lt;silent&gt;</span><span class="symbol">&lt;F4&gt;</span> <span class="symbol">&lt;cmd&gt;</span>Defx -<span class="keyword">buffer</span>-name=<span class="string">"defx"</span><span class="symbol">&lt;cr&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¤–è§€è¨­å®š</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">call</span> defx#custom#column(<span class="string">'icon'</span>, &#123;</span><br><span class="line">            \ <span class="string">'directory_icon'</span>: <span class="string">'â–¸'</span>,</span><br><span class="line">            \ <span class="string">'opened_icon'</span>: <span class="string">'â–¾'</span>,</span><br><span class="line">            \ <span class="string">'root_icon'</span>: <span class="string">'ğŸ“ '</span>,</span><br><span class="line">            \ &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> defx#custom#column(<span class="string">'filename'</span>, &#123;</span><br><span class="line">            \ <span class="string">'min_width'</span>: <span class="number">128</span>,</span><br><span class="line">            \ <span class="string">'max_width'</span>: <span class="number">128</span>,</span><br><span class="line">            \ &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> defx#custom#option(<span class="string">'_'</span>, &#123;</span><br><span class="line">            \ <span class="string">'columns'</span>: <span class="string">'mark:indent:icon:filename:type'</span>,</span><br><span class="line">            \ <span class="string">'split'</span>: <span class="string">'vertical'</span>,</span><br><span class="line">            \ <span class="string">'winwidth'</span>: <span class="number">35</span>,</span><br><span class="line">            \ <span class="string">'direction'</span>: <span class="string">'topleft'</span>,</span><br><span class="line">            \ <span class="string">'resume'</span>: <span class="variable">v:false</span>,</span><br><span class="line">            \ <span class="string">'toggle'</span>: <span class="variable">v:true</span></span><br><span class="line">            \ &#125;)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ enter æ‰“é–‹æˆ–é—œé–‰è³‡æ–™å¤¾ï¼š</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;silent&gt;</span><span class="symbol">&lt;buffer&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;CR&gt;</span></span><br><span class="line">            \ defx#is_directory() ?</span><br><span class="line">            \ defx#do_action(<span class="string">'open_or_close_tree'</span>) :</span><br><span class="line">            \ defx#do_action(<span class="string">'drop'</span>)</span><br></pre></td></tr></table></figure>


<p>å› ç‚º defx çš„é«˜åº¦å½ˆæ€§ï¼Œä»¥åŠèˆŠæœ‰çš„ nerdtreeä½¿ç”¨ç¿’æ…£ï¼Œæ‰€ä»¥æˆ‘å°±æŠŠ defx çš„ key mapping è¨­å®šæˆé¡ä¼¼ nerdtreeï¼Œé€™è£¡å°±åªåšåŸºæœ¬è¨­å®šï¼Œä»¥å¾Œæœ‰ç©ºæœƒå¤šé–‹ä¸€ç¯‡è©³ç´°è¬› defx è¨­å®šï¼Œå¦‚æœæœ‰èˆˆè¶£è«‹åƒè€ƒ<a href="https://github.com/amikai/nvimrc/blob/46d4c73f9e/config/defx.vim" target="_blank" rel="noopener">æˆ‘çš„è¨­å®š</a> </p>
<p>Note: defx (neovim only)</p>
<p>é¡ä¼¼ Plugin: <a href="https://github.com/preservim/nerdtree" target="_blank" rel="noopener">nerdtree</a> (vim and neovim), <a href="https://github.com/justinmk/vim-dirvish" target="_blank" rel="noopener">vim-dirvish</a> (vim and neovim)</p>
<h1 id="Auto-completion-completion-nvim-amp-diagnostic-diagnostic-nvim"><a href="#Auto-completion-completion-nvim-amp-diagnostic-diagnostic-nvim" class="headerlink" title="Auto completion (completion-nvim) &amp; diagnostic (diagnostic-nvim)"></a>Auto completion (completion-nvim) &amp; diagnostic (diagnostic-nvim)</h1><p>completion-nvim å’Œ diagnostic-nvim éƒ½æ˜¯åŸºæ–¼ nvim-lspconfig çš„ Pluginï¼Œ<br>å¯ä»¥æŠŠ nvim-lspconfig ç•¶æˆå’Œ language server æºé€šçš„åŸºç¤è¨­æ–½ï¼ŒGolang é è¨­çš„ language server ç•¶ç„¶å°±æ˜¯ gopls å•¦</p>
<p>å®‰è£</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">Plug <span class="string">'neovim/nvim-lspconfig'</span></span><br><span class="line">Plug <span class="string">'nvim-lua/diagnostic-nvim'</span></span><br><span class="line">Plug <span class="string">'nvim-lua/completion-nvim'</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ lsp client æ™‚ï¼Œå•Ÿå‹• <code>completion-nvim</code> å’Œ <code>diagnostic-nvim</code>ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">lua &lt;&lt; EOF</span><br><span class="line">    <span class="keyword">local</span> nvim_lsp = <span class="built_in">require</span><span class="string">'nvim_lsp'</span></span><br><span class="line">    <span class="keyword">local</span> on_attach_vim = <span class="function"><span class="keyword">function</span><span class="params">(client, bufnr)</span></span></span><br><span class="line">        <span class="built_in">require</span><span class="string">'completion'</span>.on_attach(client, bufnr)</span><br><span class="line">        <span class="built_in">require</span><span class="string">'diagnostic'</span>.on_attach(client, bufnr)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    nvim_lsp.gopls.setup&#123;</span><br><span class="line">        on_attach=on_attach_vim</span><br><span class="line">    &#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p><code>diagnostic-nvim</code> ç¯„ä¾‹è¨­å®šï¼š</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">call</span> sign_define(<span class="string">"LspDiagnosticsErrorSign"</span>, &#123;<span class="string">"text"</span> : <span class="string">"E"</span>, <span class="string">"texthl"</span> : <span class="string">"LspDiagnosticsError"</span>&#125;)</span><br><span class="line"><span class="keyword">call</span> sign_define(<span class="string">"LspDiagnosticsWarningSign"</span>, &#123;<span class="string">"text"</span> : <span class="string">"W"</span>, <span class="string">"texthl"</span> : <span class="string">"LspDiagnosticsWarning"</span>&#125;)</span><br><span class="line"><span class="keyword">call</span> sign_define(<span class="string">"LspDiagnosticsInformationSign"</span>, &#123;<span class="string">"text"</span> : <span class="string">"I"</span>, <span class="string">"texthl"</span> : <span class="string">"LspDiagnosticsInformation"</span>&#125;)</span><br><span class="line"><span class="keyword">call</span> sign_define(<span class="string">"LspDiagnosticsHintSign"</span>, &#123;<span class="string">"text"</span> : <span class="string">"H"</span>, <span class="string">"texthl"</span> : <span class="string">"LspDiagnosticsHint"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:diagnostic_show_sign</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:diagnostic_enable_virtual_text</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:diagnostic_insert_delay</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:diagnostic_virtual_text_prefix</span> = <span class="string">'&lt;'</span></span><br></pre></td></tr></table></figure>
<p>æ•ˆæœï¼š</p>
<img data-src="/2020/09/03/go_neovim_env/diagnostic_demo.gif" class="">

<p>å¦‚æœè¦ºå¾—å­—é‚„æ²’æ‰“å®Œå°±æœ‰è­¦å‘Šå¾ˆç…©ï¼Œå¯ä»¥æ”¹è®Šæ­¤é¸é … <code>let g:diagnostic_insert_delay = 1</code>ï¼Œå‰‡æœƒåœ¨é€²å…¥ normal mode æ™‚é€²è¡Œè­¦å‘Šã€‚</p>
<p><code>completion-nvim</code> ç¯„ä¾‹è¨­å®šï¼š</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:completion_chain_complete_list</span> = [</span><br><span class="line">            \&#123;<span class="string">'complete_items'</span>: [<span class="string">'lsp'</span>]&#125;,</span><br><span class="line">            \]</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœ</p>
<img data-src="/2020/09/03/go_neovim_env/completion_demo.gif" class="">

<p>Note: <code>nvim-lspconfig</code>, <code>completion-nvim</code>, <code>diagnostic-nvim</code> çš†ä¸ç›¸å®¹ vim</p>
<p>LSP ç›¸é—œ Pluginï¼š <a href="https://github.com/prabirshrestha/vim-lsp" target="_blank" rel="noopener">vim-lsp</a> (vim only), <a href="https://github.com/autozimu/LanguageClient-neovim" target="_blank" rel="noopener">LanguageClient-neovim</a> (neovim only)</p>
<p>Completion ç›¸é—œ Pluginï¼š <a href="https://github.com/ncm2/ncm2" target="_blank" rel="noopener">ncm2</a> (vim8 and neovim), <a href="https://github.com/Shougo/deoplete.nvim" target="_blank" rel="noopener">deoplete.nvim</a> (vim8 and neovim)</p>
<p>Diagnostic ç›¸é—œ Plugin: <a href="https://github.com/neomake/neomake" target="_blank" rel="noopener">neomake</a> (neovim and vim8), <a href="https://github.com/dense-analysis/ale" target="_blank" rel="noopener">ale</a> (neovim and vim8)</p>
<blockquote>
<p>çœ‹äº† completion-nvim çš„ contribution å¤§éƒ¨åˆ†æ˜¯ç”± haorenW1025 å¤§å¤§æ‰€å¯«ï¼Œå¸³è™Ÿæ› NTUï¼Œå°ç£äººå¯«çš„å¥—ä»¶é‚„ä¸æ”¯æŒä¸€æ³¢</p>
</blockquote>
<h1 id="Code-Outline-tagbar"><a href="#Code-Outline-tagbar" class="headerlink" title="Code Outline (tagbar)"></a>Code Outline (tagbar)</h1><img data-src="/2020/09/03/go_neovim_env/tagbar_demo.png" class="">

<p>ç•¶ code è¶Šå¯«è¶Šå¤šï¼Œä¸€å€‹ file è¶Šé•·è¶Šå¤§ï¼Œä¸€å€‹ file è¶…é 1000 è¡Œï¼Œæˆ–è¶…é 15 å€‹ functionï¼Œå°±éœ€è¦ä¸€å€‹ç¶œè§€å…¨å±€çš„ Pluginï¼Œé€™ç•¶ç„¶å°±éœ€è¦äº¤çµ¦ <code>tagbar</code> äº†ã€‚</p>
<p>å¦å¤–ä¸€ç¨®æƒ…å¢ƒï¼Œç•¶ä½ ä¸ç†Ÿä½ æ‰‹ä¸Šçš„é€™ä»½å°ˆæ¡ˆæ™‚ï¼Œç”¨ <code>tagbar</code> å…ˆé€²è¡Œå¤§ç¶±å¼çš„è§€å¯Ÿï¼Œæ˜¯å†å¥½ä¸éçš„æ–¹å¼äº†</p>
<p>é¦–å…ˆå…ˆå®‰è£ <a href="https://github.com/jstemmer/gotags" target="_blank" rel="noopener">gotags</a>, gotags åœ¨ Readme ä¸Šéƒ½å¯«å¥½æ€éº¼è¨­å®šäº†ã€‚</p>
<p>å®‰è£ Tagbar:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">Plug <span class="string">'majutsushi/tagbar'</span></span><br></pre></td></tr></table></figure>
<p>gotags åŠ tagbar è¨­å®šï¼š</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:tagbar_type_go</span> = &#123;</span><br><span class="line">            \ <span class="string">'ctagstype'</span> : <span class="string">'go'</span>,</span><br><span class="line">            \ <span class="string">'kinds'</span>     : [</span><br><span class="line">            \ <span class="string">'p:package'</span>,</span><br><span class="line">            \ <span class="string">'i:imports:1'</span>,</span><br><span class="line">            \ <span class="string">'c:constants'</span>,</span><br><span class="line">            \ <span class="string">'v:variables'</span>,</span><br><span class="line">            \ <span class="string">'t:types'</span>,</span><br><span class="line">            \ <span class="string">'n:interfaces'</span>,</span><br><span class="line">            \ <span class="string">'w:fields'</span>,</span><br><span class="line">            \ <span class="string">'e:embedded'</span>,</span><br><span class="line">            \ <span class="string">'m:methods'</span>,</span><br><span class="line">            \ <span class="string">'r:constructor'</span>,</span><br><span class="line">            \ <span class="string">'f:functions'</span></span><br><span class="line">            \ ],</span><br><span class="line">            \ <span class="string">'sro'</span> : <span class="string">'.'</span>,</span><br><span class="line">            \ <span class="string">'kind2scope'</span> : &#123;</span><br><span class="line">            \ <span class="string">'t'</span> : <span class="string">'ctype'</span>,</span><br><span class="line">            \ <span class="string">'n'</span> : <span class="string">'ntype'</span></span><br><span class="line">            \ &#125;,</span><br><span class="line">            \ <span class="string">'scope2kind'</span> : &#123;</span><br><span class="line">            \ <span class="string">'ctype'</span> : <span class="string">'t'</span>,</span><br><span class="line">            \ <span class="string">'ntype'</span> : <span class="string">'n'</span></span><br><span class="line">            \ &#125;,</span><br><span class="line">            \ <span class="string">'ctagsbin'</span>  : <span class="string">'gotags'</span>,</span><br><span class="line">            \ <span class="string">'ctagsargs'</span> : <span class="string">'-sort -silent'</span></span><br><span class="line">            \ &#125;</span><br></pre></td></tr></table></figure>


<h1 id="Go-development-plugin-vim-go"><a href="#Go-development-plugin-vim-go" class="headerlink" title="Go development plugin (vim-go)"></a>Go development plugin (vim-go)</h1><p>Golang åœ¨ vim çš„é–‹ç™¼ä¸­ï¼Œä¸å¯èƒ½ä¸æ <code>vim-go</code> äº†ï¼Œæ‡‰è©²ä¹Ÿæ˜¯æˆ‘åœ¨ vim plugin çœ‹éæ”¯æ´å®Œæ•´çš„é–‹ç™¼å·¥å…·ä¹‹ä¸€äº†ï¼Œvim-go è¨­å®šçœ¾å¤šï¼Œæˆ‘åªæŒ‘å‡ºäº†æˆ‘è¦ºå¾—æœ€æœ‰ç”¨çš„å¹¾å€‹å‡ºä¾†è«‡ã€‚</p>
<p>å®‰è£</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">Plug <span class="string">'fatih/vim-go'</span>,&#123;<span class="string">'for'</span>:<span class="string">'go'</span>, <span class="string">'do'</span>: <span class="string">':GoUpdateBinaries'</span>&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/golangci/golangci-lint" target="_blank" rel="noopener">golangci-lint</a> æ˜¯æŠŠä¸ä¸€æ¨£çš„ go èªè¨€ linter é›†åˆèµ·ä¾†æˆä¸€åŒ…ï¼Œåœ¨ teminal æ‰“ <code>golangci-lint linters</code> å°±æœƒåˆ—å‡ºä¸€å † linterï¼ŒæŒ‘é¸è‡ªå·±æƒ³è¦çš„ linter æ”¾å…¥ <code>g:go_metalinter_enabled</code> é™£åˆ—è£¡ã€‚</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:go_metalinter_command</span> = <span class="string">"golangci-lint"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:go_metalinter_enabled</span> = [<span class="string">'vet'</span>, <span class="string">'errcheck'</span>, <span class="string">'staticcheck'</span>, <span class="string">'gosimple'</span>]</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <code>:GoMetaLinter</code> é–‹å§‹å°å°ˆæ¡ˆé€²è¡Œæª¢æŸ¥ã€‚</p>
<p>ç•¶ç„¶ code è¶Šå¤§æˆ–æ˜¯ linter æ”¾å¾—è¶Šå¤šæª¢æŸ¥è¶Šæ…¢ï¼Œæ‰€ä»¥æˆ‘é€šå¸¸å¯«åˆ°ä¸€å€‹æ®µè½æ‰ä¸‹æ­¤å‘½ä»¤ï¼Œlinter æª¢æŸ¥å®Œå¾Œ quickfix list å‰‡æœƒè·³å‡ºï¼Œè«‹çœ‹demoï¼š</p>
<img data-src="/2020/09/03/go_neovim_env/golangci_lint_demo.gif" class="">

<p>code navigation è¨­å®šï¼Œä¸ä½¿ç”¨ <code>vim-go</code> é è¨­çš„ key mappingï¼Œä½¿ç”¨è‡ªå·±ç¿’æ…£çš„æ–¹å¼ï¼š</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:go_def_mapping_enabled</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> gd <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-def)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> gD <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-describe)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> gR <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-<span class="built_in">rename</span>)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> <span class="keyword">gr</span> <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-referrers)</span><br></pre></td></tr></table></figure>

<p>æœ€å±Œçš„æ˜¯ vim-go èƒ½ç›´æ¥è·‘ Testing (<code>:GoTest</code>), Debugger (<code>:GoDebugStart</code>), Run (<code>:GoRun</code>), Build (<code>:GoBuild</code>)</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> <span class="symbol">&lt;f4&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-test)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> <span class="symbol">&lt;f5&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-build)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">go</span> <span class="keyword">nmap</span> <span class="symbol">&lt;buffer&gt;</span> <span class="symbol">&lt;f6&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">go</span>-run)</span><br></pre></td></tr></table></figure>

<p><code>:GoTest</code> demoï¼š</p>
<img data-src="/2020/09/03/go_neovim_env/go_test_demo.gif" class="">

<p>vim-go è¨­å®šä¸€å®šè¦çœ‹é <a href="https://github.com/fatih/vim-go-tutorial" target="_blank" rel="noopener">vim-go-tutorial</a>ï¼Œç”± vim-go ä½œè€…æä¾›çš„è¨­å®šæ•™å­¸ã€‚</p>
<h1 id="çµèª"><a href="#çµèª" class="headerlink" title="çµèª"></a>çµèª</h1><p>å¦‚æœè¦ä¸€å€‹é©åˆè‡ªå·±çš„ (neo)vim ç’°å¢ƒï¼Œç•¶ç„¶é€™ç¯‡æ–‡ç« åªæ˜¯å†°å±±ä¸€è§’è€Œå·²ã€‚é€™è£¡æåˆ°çš„ Pluginï¼Œæ¯ä¸€å€‹éƒ½å¯ä»¥é–‹ä¸€ç¯‡æ–‡ç« ä¾†ä»‹ç´¹ï¼Œæ‰€ä»¥æ¯ä¸€å€‹ Plugin æˆ‘ç›¡é‡ç”¨æœ€ç°¡å–®çš„ç¯„ä¾‹è¨­å®šï¼Œå±•ç¾å®ƒçš„åŠŸèƒ½å’Œç²¾é«“ã€‚å¦å¤–é‚„æœ‰ fuzzy finder, auto pair, indent line guide, snippet ..ç­‰ Plugin, é‚„æ²’æåˆ°ï¼Œä¹‹å¾Œæœƒåˆ†å¥½å¹¾ç¯‡æ–‡ç« ä¾†å¯«ã€‚</p>
<p>åœ¨é…ç½®è¨­å®šçš„ä¸€é–‹å§‹ï¼Œç›¡é‡å…ˆå»æŠ„åˆ¥äººçš„ï¼Œç›´æ¥çœ‹çœ‹æŠ„äº†è¨­å®šæœƒç™¼ç”Ÿä»€éº¼æ•ˆæœï¼Œ æˆ–æ˜¯ä½¿ç”¨ <code>:help</code> æŸ¥è©¢çœ‹çœ‹ã€‚</p>
<h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h1><p>è¦å»å“ªè£¡æŸ¥åˆ°åˆ¥äººçš„ vim è¨­å®šï¼Ÿ<br>åœ¨ github ä¸ŠæŸ¥è©¢é—œéµå­—ï¼šdotfile, dotfiles, vimrc, vim-config, nvimrc ç­‰ç­‰çš„å­—ã€‚<br>é€™è£¡æˆ‘å°±æä¾›å…©å€‹å¤§ç¥çš„ vim è¨­å®šï¼š</p>
<ul>
<li><a href="https://github.com/Shougo/shougo-s-github" target="_blank" rel="noopener">https://github.com/Shougo/shougo-s-github</a></li>
<li><a href="https://github.com/rafi/vim-config" target="_blank" rel="noopener">https://github.com/rafi/vim-config</a></li>
</ul>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://github.com/neovim/nvim-lspconfig" target="_blank" rel="noopener">https://github.com/neovim/nvim-lspconfig</a></li>
<li><a href="https://github.com/fatih/vim-go-tutorial" target="_blank" rel="noopener">https://github.com/fatih/vim-go-tutorial</a></li>
</ul>
]]></content>
      <tags>
        <tag>vimrc</tag>
      </tags>
  </entry>
  <entry>
    <title>Golang 78 èªæ³•ç¯‡ - method set</title>
    <url>/2020/07/07/golang78syntax2/</url>
    <content><![CDATA[<p><code>method set</code>, <code>interface</code>, <code>auto deference or reference</code> ç•¶é€™äº›èªæ³•ç¶œåˆå†ä¸€èµ·ä½¿ç”¨æ™‚ï¼Œå¾ˆå®¹æ˜“æ··æ·†ï¼Œç”šè‡³å¯«å‡º bug codeï¼Œé€™ç« æˆ‘å€‘å°±é€éé¡Œç›®æ¢è¨ä¸€ä¸‹ <code>method set</code> å¸¸å¸¸è¢«å¤§å®¶èª¤æœƒçš„åœ°æ–¹ã€‚</p>
<p><a href="golang78syntax.md">Golang 78 èªæ³•ç¯‡ - interface</a>  <code>Line 50</code> çš„æ¦‚å¿µå°±åœ¨é€™ç¯‡ã€‚</p>
<h1 id="é¡Œç›®"><a href="#é¡Œç›®" class="headerlink" title="é¡Œç›®"></a>é¡Œç›®</h1><p>è«‹å•ä»¥ä¸‹ç¨‹å¼è¼¸å‡ºçµæœç‚ºä½•</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e Employee)</span> <span class="title">DoWork</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"do work"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	(&amp;Employee&#123;&#125;).DoWork()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆåªæœ‰å…©ç¨®æ–¹å‘:<br>    1. ç„¡æ³•ç·¨è­¯<br>    2. å°å‡º do work</p>
<p>é€™å€‹ç¨‹å¼å¯ä»¥ç·¨è­¯ï¼Œä¸¦ä¸”é‚„å°å‡º do work ä½†æ˜¯ç‚ºä»€éº¼å‘¢ï¼Ÿ</p>
 <a id="more"></a>

<h1 id="Method-set"><a href="#Method-set" class="headerlink" title="Method set"></a>Method set</h1><p>åœ¨ receiver argument å’Œ receiver parameter ä¸ä¸€æ¨£çš„æƒ…æ³ä¸‹ï¼Œç›´è¦ºåæ‡‰å°±æ˜¯ <code>implicit dereference</code> å’Œ <code>implicit reference</code> åœ¨èƒŒå¾Œæœƒå¹«å¿™ï¼Œä½†æ˜¯é€™å€‹å¯«æ³• (struct literal) æ˜¯ä¸æœƒæœ‰æ­¤æƒ…æ³çš„ã€‚</p>
<p>æ—¢ç„¶æ²’æœ‰ <code>implicit dereference</code> å’Œ <code>implicit reference</code> çš„æ”¯æ´ï¼Œé‚£ä¸€å®šå­˜åœ¨å…¶å®ƒæ©Ÿåˆ¶ä½¿å¾—é€™æ®µ code èƒ½æ­£å¸¸ç·¨è­¯ã€‚</p>
<p>ä»¥ä¸‹å¾ <a href="https://golang.org/ref/spec#Method_sets" target="_blank" rel="noopener">Golang Specification</a>æ‰€æˆªå–çš„å¥å­:</p>
<p>The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T)</p>
<p>ä»¥ä¸‹æ˜¯å¾ <a href="https://golang.org/doc/faq#different_method_sets" target="_blank" rel="noopener">Golang FAQ</a> æ‰€æˆªå–çš„å¥å­:</p>
<p>As the Go specification says, the method set of a type T consists of all methods with receiver type T, while that of the corresponding pointer type *T consists of all methods with receiver *T or T. That means the method set of *T includes that of T, but not the reverse</p>
<p>å…¶å¯¦æ„æ€å°±æ˜¯å‹æ…‹ T çš„æ‰€æœ‰ method åŒ…å«äº†æ‰€æœ‰ receiver å‹æ…‹æ˜¯ T çš„ methodï¼Œé€™ç†æ‰€ç•¶ç„¶ï¼Œçœ‹èµ·ä¾†ä¹Ÿåƒå»¢è©±ï¼Œå¦ä¸€å¥æ‰æ˜¯é—œéµï¼Œä¹Ÿæ˜¯ä»Šæ—¥çš„é‡é»ï¼š*T å‹æ…‹çš„æ‰€æœ‰ method åŒ…å«äº† receiver å‹æ…‹æ˜¯ T åŠ *T çš„ methodã€‚</p>
<p>æœ‰äº†æ­¤çµè«–æˆ‘å€‘å°±èƒ½çŸ¥é“ <code>*Employee</code> çš„ method set è£¡æ˜¯æœ‰ <code>DoWork()</code>ï¼Œæ‰€ä»¥ç·¨è­¯æœƒéã€‚</p>
<p>é‚£é€™å°±æœ‰è¶£äº†ï¼Œå†çœ‹ä¸€å€‹å»¶ä¼¸é¡Œï¼Œè«‹å•é€™æ®µ code ç·¨è­¯æœƒä¸æœƒé:</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Worker <span class="keyword">interface</span> &#123;</span><br><span class="line">	DoWork()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e Employee)</span> <span class="title">DoWork</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"do work"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> w Worker = &amp;Employee&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€™æ®µ code å•çš„å…¶å¯¦å°±æ˜¯ Employee åˆ°åº•æœ‰æ²’æœ‰ç¬¦åˆ(satisfy) <code>Worker</code> ä»‹é¢ï¼Œæ ¹æ“šå‰›å‰›æ‰€å¾—å‡ºçš„çµè«–ï¼Œ <code>*Employee</code> çš„ method set è£¡æ˜¯æœ‰åŒ…å« <code>DoWork</code> çš„ï¼Œæ‰€ä»¥ç·¨è­¯æ˜¯æœƒéçš„ã€‚</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol>
<li><a href="https://golang.org/doc/faq#different_method_sets" target="_blank" rel="noopener">Golang Frequently Asked Questions (FAQ)</a></li>
<li><a href="https://golang.org/ref/spec#Method_sets" target="_blank" rel="noopener">The Go Programming Language Specification - Method sets</a></li>
</ol>
]]></content>
      <categories>
        <category>golang78 syntax series</category>
      </categories>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>Golang 78 èªæ³•ç¯‡ - interface</title>
    <url>/2020/07/03/golang78syntax/</url>
    <content><![CDATA[<p>Interface å¯ä»¥èªªæ˜¯ golang çš„ç²¾é«“ä¹‹ä¸€ã€‚golang interface ç‰¹æ®Šçš„èªæ³•ä»¥åŠæ¦‚å¿µä¹Ÿæ˜¯å·¥ç¨‹å¸«å¸¸å¸¸çŠ¯éŒ¯çš„åœ°æ–¹ã€‚æ­¤é¡Œåªæ˜¯ç”¨ä¾†é‡æ¸…è‡ªå·±çš„æ¦‚å¿µã€‚</p>
<h1 id="é¡Œç›®"><a href="#é¡Œç›®" class="headerlink" title="é¡Œç›®"></a>é¡Œç›®</h1><p>è«‹å•ä»¥ä¸‹ç¨‹å¼è¼¸å‡ºçµæœç‚ºä½•</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> S <span class="keyword">struct</span>&#123;</span><br><span class="line">    val <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s S)</span> <span class="title">F</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IF <span class="keyword">interface</span> &#123;</span><br><span class="line">	F()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitType</span><span class="params">()</span> <span class="title">S</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s S</span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitPointer</span><span class="params">()</span> *<span class="title">S</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s *S</span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitEfaceType</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">var</span> s S</span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitEfacePointer</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">var</span> s *S</span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitIfaceType</span><span class="params">()</span> <span class="title">IF</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s S</span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitIfacePointer</span><span class="params">()</span> <span class="title">IF</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s *S</span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// fmt.Println(InitType() == nil) // type mismatch</span></span><br><span class="line">	fmt.Println(InitPointer() == <span class="literal">nil</span>)</span><br><span class="line">	fmt.Println(InitEfaceType() == <span class="literal">nil</span>)</span><br><span class="line">	fmt.Println(InitEfacePointer() == <span class="literal">nil</span>)</span><br><span class="line">	fmt.Println(InitIfaceType() == <span class="literal">nil</span>)</span><br><span class="line">	fmt.Println(InitIfacePointer() == <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 <a id="more"></a>

<h1 id="å›æ­¸åŸºæœ¬"><a href="#å›æ­¸åŸºæœ¬" class="headerlink" title="å›æ­¸åŸºæœ¬"></a>å›æ­¸åŸºæœ¬</h1><p>åœ¨å›ç­”å•é¡Œä¹‹å‰å…ˆè¤‡ç¿’ä»€éº¼æ˜¯ <code>Interface Satisfaction</code> å’Œ <code>Interface Values</code> ï¼Œåˆ†åˆ¥åœ¨ The Go Programming Language ç« ç¯€ 7.3 å’Œ 7.5ã€‚</p>
<h2 id="Interface-Satisfaction"><a href="#Interface-Satisfaction" class="headerlink" title="Interface Satisfaction"></a>Interface Satisfaction</h2><p>ç›´æ¥çµ¦å‡ºæ›¸ä¸Šçš„è§£é‡‹ï¼Œé€™å…©æ®µå¥å­åŠç¯„ä¾‹ç¨‹å¼å·²ç¶“æ·ºé¡¯æ˜“æ‡‚ï¼Œä¸å¤šä½œè§£é‡‹:</p>
<p>A type <code>satisfies</code> an interface if it possesses all the methods the interface requires.</p>
<p>The assignability rule for interfaces is very simple: an expression may be assigned to an interface only if its type satisfies the interface.</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">package io</span></span><br><span class="line"><span class="comment">type Writer interface &#123;</span></span><br><span class="line"><span class="comment">    Write(p []byte) (n int, err error)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> w io.Writer</span><br><span class="line">w = os.Stdout           <span class="comment">// OK: *os.File has Write method</span></span><br><span class="line">w = <span class="built_in">new</span>(bytes.Buffer)   <span class="comment">// OK: *bytes.Buffer has Write method</span></span><br><span class="line">w = time.Second         <span class="comment">// compile error: time.Duration lacks Write method</span></span><br></pre></td></tr></table></figure>

<h2 id="Interface-Values"><a href="#Interface-Values" class="headerlink" title="Interface Values"></a>Interface Values</h2><p>The Go Programming Language 7.5 ç¬¬ä¸€å¥é–‹é–€è¦‹å±±åœ°é¦¬ä¸Šçµ¦å‡ºæ¦‚å¿µ:</p>
<p>Conceptually, a value of an interface type, or <code>interface value</code> has two components, a concrete type and a value of that type . These are called the interfaceâ€™s <code>dynamic type</code> and <code>dynamic value</code>.</p>
<p>ä¸¦ä¸”ç”¨ä¸€å€‹ä¾‹å­åšå‡ºäº†å¾ˆæ£’çš„è§£é‡‹:</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> w io.writer</span><br><span class="line">w = os.Stdout</span><br><span class="line">w = <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">w = <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<img data-src="/2020/07/03/golang78syntax/golang78syntax_1.jpg" class="" title="line1 - line4">

<p>å¦ä¸€å€‹ä¾‹å­:</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> w io.Writer</span><br><span class="line"><span class="keyword">var</span> buf *bytes.Buffer</span><br><span class="line">w = buf</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"%v %T\n"</span>, w, w) <span class="comment">// &lt;nil&gt;  *bytes.Buffer</span></span><br><span class="line"><span class="keyword">if</span> w != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"w not nil"</span>) <span class="comment">// This line will be executed</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‹¥ <code>w != nil</code> è¦æˆç«‹å‰‡ <code>dynamic type</code> å’Œ <code>dynamic value</code> çš†ç‚º <code>non-nil</code> æ‰æœƒæˆç«‹ã€‚<br>å› ç‚º w çš„ dynamic value æ˜¯ <code>*bytes.Buffer</code> ä¸ç‚º <code>nil</code> æ‰€ä»¥ <code>w != nil</code> å°±æœƒæˆç«‹ã€‚</p>
<img data-src="/2020/07/03/golang78syntax/golang78syntax_2.jpg" class="">

<h1 id="è§£ç­”"><a href="#è§£ç­”" class="headerlink" title="è§£ç­”"></a>è§£ç­”</h1><p>é¡Œç›®çš„ Line 43, 44 é›£åº¦ä¸é«˜ï¼Œç›´æ¥è·³é<br>å‰©ä¸‹çš„çœ‹ä¸‹åœ–</p>
<img data-src="/2020/07/03/golang78syntax/golang78syntax_3.jpg" class="">

<p>Line 50 ç‰½æ‰¯åˆ°äº† <code>method set</code> çš„ç´°ç¯€ï¼Œç•™è‘—ä¸‹ç¯‡è§£é‡‹ï¼Œå¯ä»¥åƒè€ƒ Reference 1, 2</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol>
<li><a href="https://golang.org/ref/spec#Method_sets" target="_blank" rel="noopener">https://golang.org/ref/spec#Method_sets</a></li>
<li><a href="https://stackoverflow.com/questions/33587227/method-sets-pointer-vs-value-receiver" target="_blank" rel="noopener">https://stackoverflow.com/questions/33587227/method-sets-pointer-vs-value-receiver</a></li>
</ol>
]]></content>
      <categories>
        <category>golang78 syntax series</category>
      </categories>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
</search>
